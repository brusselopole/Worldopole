!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],function(){return a.holmes=b(document)}):"object"==typeof exports?module.exports=b(document):a.holmes=b(document)}(this,function(a){"use strict";function b(c){function e(){if(b.prototype.input instanceof HTMLInputElement)return b.prototype.input.value.toLowerCase();if(b.prototype.input.contentEditable)return b.prototype.input.textContent.toLowerCase();throw new Error("The Holmes input was no <input> or contenteditable.")}function f(a){b.prototype.options.class.visible&&a.classList.remove(b.prototype.options.class.visible),a.classList.contains(b.prototype.options.class.hidden)||(a.classList.add(b.prototype.options.class.hidden),b.prototype.hidden++,"function"==typeof b.prototype.options.onHidden&&b.prototype.options.onHidden(a)),b.prototype.options.mark&&(a.innerHTML=a.innerHTML.replace(/<\/?mark>/g,""))}function g(a){b.prototype.options.class.visible&&a.classList.add(b.prototype.options.class.visible),a.classList.contains(b.prototype.options.class.hidden)&&(a.classList.remove(b.prototype.options.class.hidden),b.prototype.hidden--,"function"==typeof b.prototype.options.onVisible&&b.prototype.options.onVisible(a)),b.prototype.options.mark&&(a.innerHTML=a.innerHTML.replace(/<\/?mark>/g,""),b.prototype.searchString.length&&(a.innerHTML=a.innerHTML.replace(b.prototype.regex,"<mark>$1</mark>")))}function h(){var c=!1;b.prototype.searchString=e(),b.prototype.options.minCharacters&&0!==b.prototype.searchString.length&&b.prototype.options.minCharacters>b.prototype.searchString.length||(b.prototype.options.dynamic&&(b.prototype.elements=a.querySelectorAll(b.prototype.options.find),b.prototype.elementsLength=b.prototype.elements.length,b.prototype.elementsArray=Array.prototype.slice.call(b.prototype.elements)),b.prototype.options.mark&&(b.prototype.regex=new RegExp("("+b.prototype.searchString+")(?![^<]*>)","gi")),b.prototype.elementsArray.forEach(function(a){a.textContent.toLowerCase().indexOf(b.prototype.searchString)===-1?f(a):(g(a),d&&"function"==typeof b.prototype.options.onFound&&b.prototype.options.onFound(b.prototype.placeholderNode),d=!1,c=!0)}),"function"==typeof b.prototype.options.onInput&&b.prototype.options.onInput(b.prototype.searchString),c||d?d||b.prototype.options.placeholder&&b.prototype.placeholderNode.classList.add(b.prototype.options.class.hidden):(d=!0,b.prototype.options.placeholder&&b.prototype.placeholderNode.classList.remove(b.prototype.options.class.hidden),"function"==typeof b.prototype.options.onEmpty&&b.prototype.options.onEmpty(b.prototype.placeholderNode)))}var d=!1;if("object"!=typeof c)throw new Error('The options need to be given inside an object like this:\nholmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/module-holmes.html');if("string"!=typeof c.find)throw new Error('A find argument is needed. That should be a querySelectorAll for each of the items you want to match individually. You should have something like: \nholmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/module-holmes.html');b.prototype.options={input:"input[type=search]",find:void 0,placeholder:void 0,mark:!1,class:{visible:void 0,hidden:"hidden"},dynamic:!1,instant:!1,minCharacters:0,onHidden:void 0,onVisible:void 0,onEmpty:void 0,onFound:void 0,onInput:void 0},b.prototype._mergeObj=function(a,c){if(!(a instanceof Object&&c instanceof Object))throw new Error("One of both arguments isn't an object.");Object.keys(a).forEach(function(d){typeof c[d]!=typeof a[d]&&void 0!==a[d]||(c[d]instanceof Object?b.prototype._mergeObj(a[d],c[d]):a[d]=c[d])})},b.prototype._mergeObj(b.prototype.options,c),b.prototype.start=function(){if(b.prototype.running=!0,b.prototype.input=a.querySelector(b.prototype.options.input),!b.prototype.options.find)throw new Error('A find argument is needed. That should be a querySelectorAll for each of the items you want to match individually. You should have something like: \nholmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/module-holmes.html');if(b.prototype.elements=a.querySelectorAll(b.prototype.options.find),b.prototype.elementsLength=b.prototype.elements.length,b.prototype.elementsArray=Array.prototype.slice.call(b.prototype.elements),b.prototype.hidden=0,b.prototype.options.placeholder){if(b.prototype.placeholderNode=a.createElement("div"),b.prototype.placeholderNode.id="holmes-placeholder",b.prototype.placeholderNode.classList.add(b.prototype.options.class.hidden),b.prototype.placeholderNode.innerHTML=b.prototype.options.placeholder,!(b.prototype.elements[0].parentNode instanceof Element))throw new Error("The Holmes placeholder could't be put; the elements had no parent.");b.prototype.elements[0].parentNode.appendChild(b.prototype.placeholderNode)}b.prototype.options.class.visible&&b.prototype.elementsArray.forEach(function(a){a.classList.add(b.prototype.options.class.visible)}),b.prototype.input.addEventListener("input",h)},e.prototype.set=function(a){if(b.prototype.input instanceof HTMLInputElement)b.prototype.input.value=a;else{if(!b.prototype.input.contentEditable)throw new Error("The Holmes input was no <input> or contenteditable.");b.prototype.input.textContent=a}},"boolean"!=typeof b.prototype.options.instant&&(b.prototype.options.instant=!1),b.prototype.options.instant?b.prototype.start(c):window.addEventListener("DOMContentLoaded",function(){b.prototype.start(c)}),b.prototype.stop=function(){return new Promise(function(a,c){try{if(b.prototype.input.removeEventListener("input",h),b.prototype.options.placeholder){if(!b.prototype.placeholderNode.parentNode)throw new Error("The Holmes placeholderNode has no parent.");b.prototype.placeholderNode.parentNode.removeChild(b.prototype.placeholderNode)}b.prototype.options.mark&&b.prototype.elementsArray.forEach(function(a){a.innerHTML=a.innerHTML.replace(/<\/?mark>/g,"")}),b.prototype.running=!1,a("This instance of Holmes has been stopped.")}catch(a){c(a)}})},b.prototype.clear=function(){e.prototype.set(""),b.prototype.options.class.visible?b.prototype.elementsArray.forEach(function(a){a.classList.remove(b.prototype.options.class.hidden),a.classList.add(b.prototype.options.class.visible)}):b.prototype.elementsArray.forEach(function(a){a.classList.remove(b.prototype.options.class.hidden)}),b.prototype.options.placeholder&&(b.prototype.placeholderNode.classList.add(b.prototype.options.class.hidden),b.prototype.options.class.visible&&b.prototype.placeholderNode.classList.remove(b.prototype.options.class.visible)),b.prototype.hidden=0},b.prototype.count=function(){return{all:b.prototype.elementsLength,hidden:b.prototype.hidden,visible:b.prototype.elementsLength-b.prototype.hidden}}}return b});
